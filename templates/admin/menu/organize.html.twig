{% extends '@SonataAdmin/standard_layout.html.twig' %}

{% block title %}Organize Menu: {{ menu.name }}{% endblock %}

{% block sonata_page_content %}
    <div class="page-actions mb-3">
        <a href="{{ path('admin_app_menu_list') }}" class="btn btn-secondary">
            <i class="fa fa-arrow-left"></i> Back to Menus
        </a>
        <button type="button" id="save-menu-order" class="btn btn-primary">
            <i class="fa fa-save"></i> Save Changes
        </button>
    </div>

    <h1 class="mb-4">Organize Menu: {{ menu.name }}</h1>
<div class="menu-organizer">
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h3>Current Menu Items</h3>
                    <small>Drag and drop to reorder or create sub-menus</small>
                </div>
                <div class="card-body">
                    <div id="menu-items-container" class="menu-items-list">
                        {% for menuItem in menuItems %}
                            {{ include('admin/menu/_menu_item.html.twig', { 'item': menuItem }) }}
                        {% else %}
                            <div class="empty-state">
                                <i class="fa fa-sitemap fa-3x text-muted"></i>
                                <p class="mt-3">No menu items yet. Add items from the available items panel.</p>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h3>Available Menu Items</h3>
                    <small>Drag to add to current menu</small>
                </div>
                <div class="card-body">
                    <div id="available-items-container" class="available-items-list">
                        {% for availableItem in availableItems %}
                            {% if availableItem.menu.id != menu.id %}
                                {{ include('admin/menu/_available_item.html.twig', { 'item': availableItem }) }}
                            {% endif %}
                        {% endfor %}
                        
                        {% if availableItems|filter(item => item.menu.id != menu.id)|length == 0 %}
                            <div class="empty-state">
                                <i class="fa fa-plus-circle fa-3x text-muted"></i>
                                <p class="mt-3">No additional menu items available. Create new menu items first.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div class="card mt-3">
                <div class="card-header">
                    <h3>Instructions</h3>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled small">
                        <li><i class="fa fa-arrows-alt text-primary"></i> Drag items to reorder</li>
                        <li><i class="fa fa-indent text-primary"></i> Drag items under others to create sub-menus</li>
                        <li><i class="fa fa-plus text-success"></i> Drag from available items to add to this menu</li>
                        <li><i class="fa fa-trash text-danger"></i> Drag to trash to remove from menu</li>
                        <li><i class="fa fa-save text-info"></i> Click "Save Changes" when done</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="trash-zone" class="trash-zone">
    <div class="trash-container">
        <i class="fa fa-trash fa-2x"></i>
        <p>Drop here to remove from menu</p>
    </div>
</div>

<div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="success-toast" class="toast" role="alert">
        <div class="toast-header">
            <strong class="me-auto">Success</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body">
            Menu order saved successfully!
        </div>
    </div>
    
    <div id="error-toast" class="toast" role="alert">
        <div class="toast-header">
            <strong class="me-auto">Error</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body">
            Error saving menu order. Please try again.
        </div>
    </div>
</div>
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        .menu-organizer {
            min-height: 600px;
        }
        
        .menu-items-list, .available-items-list {
            min-height: 400px;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 15px;
            background: #f8f9fa;
        }
        
        .menu-item {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            margin-bottom: 8px;
            padding: 12px;
            cursor: move;
            transition: all 0.2s ease;
        }
        
        .menu-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .menu-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }
        
        .menu-item .handle {
            color: #6c757d;
            margin-right: 10px;
        }
        
        .menu-item .title {
            font-weight: 500;
        }
        
        .menu-item .url {
            color: #6c757d;
            font-size: 0.9em;
        }
        
        .menu-item .status {
            float: right;
        }
        
        .menu-item.children {
            margin-left: 30px;
            border-left: 3px solid #007bff;
            padding-left: 15px;
        }
        
        .available-item {
            background: white;
            border: 1px solid #28a745;
            border-radius: 6px;
            margin-bottom: 8px;
            padding: 12px;
            cursor: move;
            transition: all 0.2s ease;
        }
        
        .available-item:hover {
            box-shadow: 0 2px 8px rgba(40,167,69,0.2);
        }
        
        .drop-zone {
            background: #e3f2fd !important;
            border-color: #2196f3 !important;
        }
        
        .trash-zone {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 200px;
            height: 100px;
            background: #f8d7da;
            border: 2px dashed #dc3545;
            border-radius: 8px;
            display: none;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: #721c24;
            transition: all 0.3s ease;
        }
        
        .trash-zone.active {
            display: flex;
            background: #f5c6cb;
            border-color: #dc3545;
            transform: scale(1.1);
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
        
        .page-actions {
            margin-bottom: 20px;
        }
        
        .page-actions .btn {
            margin-right: 10px;
        }
    </style>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('js/menu-organizer.js') }}"></script>
{% endblock %}